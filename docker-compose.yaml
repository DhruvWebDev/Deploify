services:
  # Deploy-Code Service
  backend:
    container_name: backend
    build:
      context: ./deploy-code
      dockerfile: dockerfile
    ports:
      - "3000:3000" # Keep the deploy-code service on port 3000 (host and container)
    volumes:
      - ./deploy-code:/app
      - /app/node_modules
    networks:
      - app_network

  # Frontend Service
  frontend:
    container_name: frontend
    build:
      context: ./frontend
      dockerfile: dockerfile
    ports:
      - "3001:5173" # Change the frontend to use port 3001 on the host
    volumes:
      - ./frontend:/app
      - /app/node_modules
    networks:
      - app_network

  # Event Service
  webhook:
    container_name: webhook
    build:
      context: ./webhook-event-handler
      dockerfile: dockerfile
    ports:
      - "3002:3000" # Keep the webhook-handler-service on port 3002 (host and container)
    volumes:
      - ./webhook-event-handler:/app
      - /app/node_modules
    environment:
      - NODE_EN=development
      - FRONTEND_URL=http://frontend:5173
    networks:
      - app_network

  # Request-Handler Service
  request:
    container_name: request-handler
    build:
      context: ./request-handler-v2
      dockerfile: dockerfile
    ports:
      - "3003:3001"
    volumes:
      - ./request-handler-v2:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
    networks:
      - app_network

# Docker Networks
networks:
  app_network:
    driver: bridge

# Docker Volumes
volumes:
  redis_data:
    driver: local